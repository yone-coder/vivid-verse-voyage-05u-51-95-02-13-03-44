
import { useState, useRef, useEffect } from 'react';
import { Search, X, Mic, Bell, QrCode } from 'lucide-react';

export default function CompactAliExpressHeader() {
  const [activeTab, setActiveTab] = useState('All');
  const [isSearchFocused, setIsSearchFocused] = useState(false);
  const [searchQuery, setSearchQuery] = useState('');
  const [voiceSearchActive, setVoiceSearchActive] = useState(false);
  const searchRef = useRef(null);
  
  const categories = [
    'All',
    'Women',
    'Men', 
    'Electronics',
    'Home',
    'Beauty',
    'Kids',
    'Sports'
  ];

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (searchRef.current && !searchRef.current.contains(event.target)) {
        // No longer need to set showRecentSearches since it's removed
      }
    };
    
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  const handleSearchFocus = () => {
    setIsSearchFocused(true);
  };

  const handleClearSearch = () => {
    setSearchQuery('');
  };

  const handleVoiceSearch = () => {
    setVoiceSearchActive(!voiceSearchActive);
  };

  return (
    <div className="flex flex-col w-full relative">
      {/* Main Header - with logo, search bar, and icons */}
      <div className="flex items-center justify-between px-3 py-2 bg-white shadow-sm">
        {/* Logo on the left */}
        <div className="flex items-center">
          <div className="mr-1">
            <svg width="24" height="24" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg">
              <path d="M0 0 C37.50067372 -0.86960167 71.35810179 8.97377602 101.71191406 31.06201172 C102.70191406 31.72201172 103.69191406 32.38201172 104.71191406 33.06201172 C104.71191406 33.72201172 104.71191406 34.38201172 104.71191406 35.06201172 C105.29457031 35.32755859 105.87722656 35.59310547 106.47753906 35.86669922 C110.39587047 37.96286952 113.46272046 41.06275608 116.71191406 44.06201172 C117.67484375 44.94373047 117.67484375 44.94373047 118.65722656 45.84326172 C139.25439272 65.52314517 153.00042624 92.64670543 159.71191406 120.06201172 C159.88835449 120.74634277 160.06479492 121.43067383 160.24658203 122.13574219 C166.38960379 146.88438782 164.17915656 175.99580687 156.71191406 200.06201172 C153.21207603 200.15004944 149.71252768 200.2027478 146.21191406 200.24951172 C145.22964844 200.27464844 144.24738281 200.29978516 143.23535156 200.32568359 C135.65921287 200.40144498 129.81374868 199.69182802 123.83691406 194.62451172 C118.48626151 188.17225423 118.56586567 181.17458985 118.43066406 173.11279297 C118.41225464 172.25952927 118.39384521 171.40626556 118.37487793 170.52714539 C118.31645054 167.80966719 118.26355864 165.09212672 118.21191406 162.37451172 C118.30765494 142.35216506 118.30765494 142.35216506 114.39941406 122.87451172 C114.17721191 122.1903418 113.95500977 121.50617188 113.72607422 120.80126953 C111.53440466 114.22155433 108.95349648 108.57606886 104.71191406 103.06201172 C104.71191406 102.40201172 104.71191406 101.74201172 104.71191406 101.06201172 C104.05191406 101.06201172 103.39191406 101.06201172 102.71191406 101.06201172 C102.71191406 100.40201172 102.71191406 99.74201172 102.71191406 99.06201172 C102.05191406 99.06201172 101.39191406 99.06201172 100.71191406 99.06201172 C100.71191406 98.40201172 100.71191406 97.74201172 100.71191406 97.06201172 C100.18597656 96.80291016 99.66003906 96.54380859 99.11816406 96.27685547 C97.29334066 95.35555664 95.48327958 94.4049456 93.68066406 93.44091797 C91.96363281 92.54179687 91.96363281 92.54179687 90.21191406 91.62451172 C89.08785156 91.02767578 87.96378906 90.43083984 86.80566406 89.81591797 C77.2437867 85.38713027 67.37567732 84.50615465 56.96191406 84.56201172 C55.7348877 84.56700684 54.50786133 84.57200195 53.24365234 84.57714844 C40.19842251 84.82705705 29.62010397 87.48821192 18.62988281 94.82763672 C16.71191406 96.06201172 16.71191406 96.06201172 13.71191406 97.06201172 C13.71191406 97.72201172 13.71191406 98.38201172 13.71191406 99.06201172 C13.05191406 99.06201172 12.39191406 99.06201172 11.71191406 99.06201172 C11.71191406 99.72201172 11.71191406 100.38201172 11.71191406 101.06201172 C11.05191406 101.06201172 10.39191406 101.06201172 9.71191406 101.06201172 C9.71191406 101.72201172 9.71191406 102.38201172 9.71191406 103.06201172 C5.96504946 102.49201889 4.2996523 100.94738881 1.64941406 98.31201172 C-6.96721291 90.46723244 -16.98274454 87.89802934 -28.28808594 86.06201172 C-29.29226562 85.89443359 -30.29644531 85.72685547 -31.33105469 85.55419922 C-48.42956232 83.47494991 -67.11303107 87.33724397 -81.19824219 97.34716797 C-92.96734681 107.00443326 -100.07925799 121.22767859 -101.86621094 136.28076172 C-102.67341197 145.33179037 -102.62473241 154.46533043 -102.76489258 163.54614258 C-103.19628423 190.31050753 -103.19628423 190.31050753 -110.28808594 198.06201172 C-114.03002814 199.97138519 -117.0748403 200.30009629 -121.24511719 200.25732422 C-122.35693359 200.25087891 -123.46875 200.24443359 -124.61425781 200.23779297 C-126.33999023 200.21265625 -126.33999023 200.21265625 -128.10058594 200.18701172 C-129.27041016 200.17798828 -130.44023437 200.16896484 -131.64550781 200.15966797 C-134.52657647 200.13614904 -137.40722583 200.10328024 -140.28808594 200.06201172 C-142.65027698 194.70041733 -144.28468532 189.84193098 -145.28808594 184.06201172 C-145.475 182.98822266 -145.66191406 181.91443359 -145.85449219 180.80810547 C-152.02173583 139.44875825 -142.33247963 99.62860225 -119.28808594 65.06201172 C-118.62808594 65.06201172 -117.96808594 65.06201172 -117.28808594 65.06201172 C-117.05089844 64.35689453 -116.81371094 63.65177734 -116.56933594 62.92529297 C-115.06306421 59.55914304 -113.13224077 57.09217999 -110.78808594 54.24951172 C-109.99402344 53.27369141 -109.19996094 52.29787109 -108.38183594 51.29248047 C-107.69089844 50.55642578 -106.99996094 49.82037109 -106.28808594 49.06201172 C-105.62808594 49.06201172 -104.96808594 49.06201172 -104.28808594 49.06201172 C-104.05089844 48.48966797 -103.81371094 47.91732422 -103.56933594 47.32763672 C-102.01215356 44.57408252 -100.16315797 42.89405538 -97.78808594 40.81201172 C-96.99402344 40.10560547 -96.19996094 39.39919922 -95.38183594 38.67138672 C-93.28808594 37.06201172 -93.28808594 37.06201172 -91.28808594 37.06201172 C-91.28808594 36.40201172 -91.28808594 35.74201172 -91.28808594 35.06201172 C-89.03269631 33.22161378 -86.77680339 31.50343538 -84.41308594 29.81201172 C-83.37535034 29.06504028 -83.37535034 29.06504028 -82.31665039 28.30297852 C-58.5160933 11.32001486 -29.34083696 0.79519554 0 0 Z " fill="#FB7D28" transform="translate(242.2880859375,143.93798828125)"/>
              <path d="M0 0 C9.70835317 10.12199228 11.02725096 23.57480926 10.95703125 36.94921875 C10.95990143 38.17606888 10.96277161 39.40291901 10.96572876 40.66694641 C10.96775657 43.24094102 10.96231737 45.8149515 10.94970703 48.38891602 C10.93359431 52.31236322 10.94962215 56.23478688 10.96875 60.15820312 C10.96676815 62.67187725 10.96292569 65.18555075 10.95703125 67.69921875 C10.96310394 68.86192795 10.96917664 70.02463715 10.97543335 71.22257996 C10.91124458 78.70118713 9.91564393 84.91089964 6.55859375 91.625 C5.89859375 91.625 5.23859375 91.625 4.55859375 91.625 C4.55859375 92.285 4.55859375 92.945 4.55859375 93.625 C-2.62538623 96.86483411 -8.61538794 97.79341411 -16.46875 97.86328125 C-17.76855553 97.87538887 -17.76855553 97.87538887 -19.09461975 97.88774109 C-20.92267889 97.90153369 -22.75076327 97.91227728 -24.57885742 97.92016602 C-26.4438433 97.9317114 -28.30879548 97.95220341 -30.17358398 97.98168945 C-32.87636638 98.02439384 -35.57817203 98.0405356 -38.28125 98.05078125 C-39.10954819 98.06828934 -39.93784637 98.08579742 -40.79124451 98.10383606 C-47.04005618 98.08052514 -50.68740655 96.3789997 -55.19140625 91.875 C-58.85074866 85.28818365 -58.80746582 77.80619311 -58.9609375 70.46875 C-58.98741867 69.40821411 -59.01389984 68.34767822 -59.04118347 67.25500488 C-59.09367038 65.0161387 -59.14129197 62.77715376 -59.18432617 60.53808594 C-59.25313854 57.16265818 -59.34935909 53.78875528 -59.44726562 50.4140625 C-59.84565915 33.82262587 -60.24514334 16.33224781 -49.12890625 2.8125 C-35.98583826 -7.88534604 -14.20169602 -11.4430932 0 0 Z " fill="#F77B28" transform="translate(322.44140625,246.375)"/>
              <!-- Include other paths from the SVG here -->
            </svg>
          </div>
        </div>
        
        {/* Search bar in the middle - reduced width */}
        <div className="flex-1 max-w-xs mx-2 relative" ref={searchRef}>
          <div className={`flex items-center bg-gray-100 rounded-full ${
            isSearchFocused ? 'border border-orange-500' : 'border border-gray-200'
          }`}>
            <Search className="ml-2 h-4 w-4 text-orange-500" />
            <input 
              className="py-1 px-2 text-xs outline-none bg-gray-100 placeholder-gray-400 w-full"
              placeholder="Search on AliExpress"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onFocus={handleSearchFocus}
            />
            
            {/* Voice search icon */}
            <div 
              className={`cursor-pointer mx-1 rounded-full ${voiceSearchActive ? 'bg-orange-100' : ''}`}
              onClick={handleVoiceSearch}
            >
              <Mic className="h-4 w-4 text-orange-500" />
            </div>
            
            {/* Clear search */}
            {searchQuery && (
              <div 
                className="cursor-pointer mr-2 rounded-full hover:bg-gray-200"
                onClick={handleClearSearch}
              >
                <X className="h-3 w-3 text-gray-500" />
              </div>
            )}
          </div>
        </div>
        
        {/* Icons on the right */}
        <div className="flex items-center space-x-3">
          {/* Notification icon */}
          <div className="cursor-pointer relative">
            <Bell className="h-5 w-5 text-gray-600" />
            <span className="absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full h-3.5 w-3.5 flex items-center justify-center">
              2
            </span>
          </div>
          
          {/* Scan icon */}
          <div className="cursor-pointer">
            <QrCode className="h-5 w-5 text-gray-600" />
          </div>
        </div>
      </div>
      
      {/* Tab Navigation */}
      <div className="flex overflow-x-auto no-scrollbar bg-white border-b border-gray-200">
        {categories.map((category) => (
          <button 
            key={category} 
            className={`whitespace-nowrap px-3 py-1 text-xs font-medium transition-all border-b-2 ${
              activeTab === category 
                ? 'border-orange-500 text-orange-500' 
                : 'border-transparent text-gray-600 hover:text-gray-900'
            }`}
            onClick={() => setActiveTab(category)}
          >
            {category}
          </button>
        ))}
      </div>

      {/* Voice search overlay */}
      {voiceSearchActive && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20">
          <div className="bg-white p-4 rounded-xl w-64 flex flex-col items-center">
            <div className="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center mb-2 animate-pulse">
              <Mic className="h-6 w-6 text-orange-500" />
            </div>
            <p className="text-sm mb-1">Listening...</p>
            <p className="text-xs text-gray-500 mb-2">Speak now to search</p>
            <button 
              className="text-xs px-4 py-1 bg-orange-500 text-white rounded-full"
              onClick={handleVoiceSearch}
            >
              Cancel
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
